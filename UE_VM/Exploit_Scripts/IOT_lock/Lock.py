
from scapy.all import sendp, send, Packet, hexdump, Ether, BitField, IP, ICMP, bind_layers, BitEnumField, get_if_addr

import os
import sys

lock_iface="uesimtun3"
src_ip=get_if_addr(lock_iface)


from Lock_data import Lock_server_ip

class Key(Packet):
    name="Key"
    fields_desc= [BitEnumField(name="Access", default=2, size=2, enum={0:"DENIED", 1: "GRANTED", 2: "REQUEST"}), BitField(name="User_ID", default=0, size=6), BitField(name="User_Password", default=0, size=8)]

bind_layers(IP, Key, proto=2)
bind_layers(Ether, IP, type=0x800)


while True:
    try:
        user_id = input("Door Locked: Enter User ID.")
        password= input("Enter Password for user "+str(user_id)+ ".")
        try:
            pkt= IP(dst=Lock_server_ip,src=src_ip, ttl=64, proto=2) / Key(User_ID=int(user_id), User_Password=int(password))
        except:
            print("Password and User ID must be ints.")
            continue
        pkt.show()
        sendp(pkt, iface=lock_iface)
    except KeyboardInterrupt:
        print("Closeing.")
        break
