udm_ip="10.0.15.1"
udr_ip="10.0.16.1"
interface="enp0s3"
ue_imsi="901700000000001"
while getopts "i:" opt; do
        case $opt in
				r)
						udr_ip="$OPTARG"
						;;
				m)
						udm_ip="$OPTARG"
						;;
                i)
                        interface="$OPTARG"
                        ;;
				u)
						ue_imsi="$OPTARG"
						;;						
                \?)
			echo "Invalid option: -$OPTARG, valid options are -r (udr ip) -m (udm ip) -u (ue imsi)-i (interface to use default enp0s3)" >&2
                        exit 1
                        ;;
        esac
done

if [[ "$interface" == "enp0s3" ]]; then
	nghttp_call="nghttp http://"
else
	ip=`/home/lily/5G/SHARED/Tools/get_ip_of_ue.sh $interface`
	if [ $? -eq 1 ]; then
		echo $interface " not a valid interface, valid is either enp0s3 or a ue address or name."
		exit 1
	fi
	cd /home/lily/UERANSIM/build
	nghttp_call="./nr-binder $ip nghttp http://"
fi


udm_prefix="$udm_ip:7777/nudm-sdm/v2/imsi-$ue_imsi/"

udm_slice_data="smf-select-data"
to_call="$nghttp_call$udm_prefix$udm_slice_data"
result=`$to_call`
echo $result 
exit 1 #todo add ddn and slice id to last udm uri

udm_uris= ("am-data" "usm-data" "ue-context-in-smf-data" "sm-data?dnn=internet&single-nssai={\"sst\":1}")
udr_uris=("/nudr-dr/v1/subscription-data/imsi-$ue_imsi/authentication-data/authentication-subscription")

UGreen='\033[0;32m'
UYellow='\033[0;33m'
color_off='\033[0m'



for ref in "${udm_uris[@]}"
do
	to_call="$nghttp_call$udm_ip:7777$ref"
	echo -e "$UYellow" $to_call
	echo -e "$color_off"
	$to_call
	echo ""
done

for ref in "${udm_uris[@]}"
do
	to_call="$nghttp_call$udm_ip:7777$ref"
	echo -e "$UYellow" $to_call
	echo -e "$color_off"
	$to_call
	echo ""
done

exit 0
