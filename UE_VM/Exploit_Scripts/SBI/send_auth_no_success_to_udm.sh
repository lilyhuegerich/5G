udm_ip="10.0.15.1"
interface="enp0s3"
while getopts "i:" opt; do
        case $opt in
		n)
			nrf_ip="$OPTARG"
			;;
                i)
                        interface="$OPTARG"
                        ;;
                \?)
			echo "Invalid option: -$OPTARG, valid options are -n (nrf ip) -i (interface to use default enp0s3)" >&2
                        exit 1
                        ;;
        esac
done

UGreen='\033[0;32m'
UYellow='\033[0;33m'
color_off='\033[0m'

uri="http://$udm_ip:7777/nudm-ueau/v1/imsi-901700000000003/auth-events"

nghttp_call="nghttp --header=':method: POST' --header='Content-Type: application/json' -d json/no_success_udm_post.json "
to_call="$nghttp_call$uri"

if [[ "$interface" == "enp0s3" ]]; then
    echo -e "$color_off" $to_call
    echo "$to_call" | bash
else
    ip=`/home/lily/5G/SHARED/Tools/get_ip_of_ue.sh $interface`
    if [ $? -eq 1 ]; then
        echo $interface " not a valid interface, valid is either enp0s3 or a ue address or name."
        exit 1
    fi
    cd /home/lily/UERANSIM/build
    if [ ! -e "tmp_sbi_call.sh" ]
    then
        touch tmp_sbi_call.sh
        sudo chmod +x tmp_sbi_call.sh
    fi
    binder_call="./nr-binder $ip ./tmp_sbi_call.sh"
    printf "#!/bin/sh \n $to_call" > tmp_sbi_call.sh
    echo -e "$color_off" $binder_call 
    cat tmp_sbi_call.sh
    echo "" > tmp_sbi_call.sh
    exit 1

fi

exit 1

#nghttp --header=':method: POST' --header='Content-Type: application/json' -d test.json http://10.0.8.1:7777/nnrf-nfm/v1/subscriptions
#nghttp --header=':method: PUT' --header='Content-Type: application/json' -d json/enrfreg1.json http://10.0.8.1:7777/nnrf-nfm/v1/nf-instances/1234

