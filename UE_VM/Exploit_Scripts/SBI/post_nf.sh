nrf_ip="10.0.8.1"
interface="enp0s3"
while getopts "i:" opt; do
        case $opt in
		n)
			nrf_ip="$OPTARG"
			;;
                i)
                        interface="$OPTARG"
                        ;;
                \?)
			echo "Invalid option: -$OPTARG, valid options are -n (nrf ip) -i (interface to use default enp0s3)" >&2
                        exit 1
                        ;;
        esac
done

if [[ "$interface" == "enp0s3" ]]; then
	nghttp_call="nghttp "
else
	ip=`/home/lily/5G/SHARED/Tools/get_ip_of_ue.sh $interface`
	if [ $? -eq 1 ]; then
		echo $interface " not a valid interface, valid is either enp0s3 or a ue address or name."
		exit 1
	fi
	cd /home/lily/UERANSIM/build
	nghttp_call="./nr-binder $ip "
fi
#nghttp --header=':method: POST' --header='Content-Type: application/json' -d test.json http://10.0.8.1:7777/nnrf-nfm/v1/subscriptions

uri="http://$nrf_ip:7777/nnrf-nfm/v1/subscriptions"

UGreen='\033[0;32m'
UYellow='\033[0;33m'
color_off='\033[0m'

to_call="$nghttp_call --header='method:PUT' $uri"
echo -e "$color_off" $to_call
result=`$to_call`

nghttp_call=${nghttp_call%"http://"} 
echo "$result"
exit 0
href_list=$(echo $result | jq -r '._links.items[].href' )
hrefs=$'\n' read -rd '' -a href_list <<< "$href_list"
echo "${href_list[@]}"

for ref in "${href_list[@]}"
do
	to_call="$nghttp_call$ref"
	echo -e "$UYellow" $to_call
	echo -e "$color_off"
	$to_call
	echo ""
done

exit 0
