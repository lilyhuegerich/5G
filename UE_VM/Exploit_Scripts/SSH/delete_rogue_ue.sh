#!/bin/bash

path_to_open_5gs=$(find / -type d -name "open5gs" | head -n 1)
cd ${path_to_open_5gs}
cd misc/db/python
pwd

python3
import Open5GS

print()

O= Open5GS.Open5GS("127.0.0.1", 27017) #connect to mongodb of open5gs

def check_subscribers(O):
	subscribers=O.GetSubscribers()		# check open5gs subscibers

	print()
	print("##############################################################")
	print()
	print()
	print("Subscribed to core network:")  
	for subscriber in subscribers:
		print()
		print(subscriber)
		print()
		print ("IMSI:", subscriber["imsi"])  #check subscriber data
		for slice in subscriber["slice"]:
			#print (slice)
			print("In slice: sst:", slice["sst"], ", slice name: ", slice["session"][0]["name"], ", priority level: ", slice["session"][0]["qos"]["arp"]["priority_level"])

	print()
	print("##############################################################")
	print()
	print()



def delete__rogue_subscribers(O):
	subscribers=O.GetSubscribers()			# check open5gs subscibers

	print()
	print("##############################################################")
	print()
	print()
	for subscriber in subscribers:
		delete_me=0
		#print ("IMSI:", subscriber["imsi"])  #check subscriber data
		for slice in subscriber["slice"]:
			if "rogue" in slice["session"][0]["name"]:
				delete_me=1
			if delete_me==1:
				print ("Deleting Rogue Ue, ", subscriber["imsi"])
				O.DeleteSubscriber(subscriber["imsi"])

	print()
	print("##############################################################")
	print()
	print()



delete__rogue_subscribers(O)

check_subscribers(O)

exit()




